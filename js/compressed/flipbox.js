(function(e){e.extend(e.mobile.datebox.prototype.options,{themeDatePick:"b",themeDate:"a",useSetButton:true,validHours:false,flen:{y:15,m:12,d:20,h:12,i:15},durationStep:1,durationSteppers:{d:1,h:1,i:1,s:1}});e.extend(e.mobile.datebox.prototype,{_fbox_pos:function(){var t,n,r,i,s=this,o=this.d.intHTML.find(".ui-datebox-flipcontent").innerHeight();s.d.intHTML.find(".ui-datebox-flipcenter").each(function(){n=e(this);r=n.innerHeight();n.css("top",(o/2-r/2-3)*-1)});s.d.intHTML.find("ul").each(function(){n=e(this);o=n.parent().innerHeight();r=n.find("li").first();i=n.find("li").last().offset().top-n.find("li").first().offset().top;t=((i-o)/2+r.outerHeight())*-1;r.css("marginTop",t)})},_fbox_fixstep:function(t){var n=this.options.durationSteppers,r=this.options.durationStep;if(e.inArray("h",t)>-1){n.d=1;n.h=r}if(e.inArray("i",t)>-1){n.h=1;n.i=r}if(e.inArray("s",t)>-1){n.i=1;n.s=r}},_fbox_series:function(e,t,n,r){var i,s,o=this.options,u=n==="h"?24:60,a=[[e.toString(),e]];for(var f=1;f<=t;f++){i=e+f*o.durationSteppers[n];s=e-f*o.durationSteppers[n];a.unshift([i.toString(),i]);if(s>-1){a.push([s.toString(),s])}else{if(r){a.push([(u+s).toString(),s])}else{a.push(["",-1])}}}return a},_fbox_mktxt:{y:function(e){return this.theDate.get(0)+e},m:function(e){var t=this.theDate.copy([0],[0,0,1]).adj(1,e);return this.__("monthsOfYearShort")[t.get(1)]},d:function(e){return this.theDate.copy([0,0,e]).get(2)},h:function(e){var t=this.theDate.copy([0,0,0,e]);return this.__("timeFormat")===12?t.get12hr():t.get(3)},i:function(e){return this._zPad(this.theDate.copy([0,0,0,0,e]).get(4))}}});e.extend(e.mobile.datebox.prototype._build,{timeflipbox:function(){this._build.flipbox.apply(this)},durationflipbox:function(){this._build.flipbox.apply(this)},flipbox:function(){var t,n,r,i,s,o,u=this,a=this.options,f=this.drag,l={},c=["d","h","i","s"],h=a.mode==="durationflipbox"?true:false,p="ui-datebox-",d=e("<div class='ui-overlay-shadow'><ul></ul></div>"),v=e("<div>",{"class":p+"flipcontent"}),m=u.theDate.getTime()-u.initDate.getTime(),g=u._dur(m<0?0:m),y,b;if(m<0){u.lastDuration=0;if(h){u.theDate.setTime(u.initDate.getTime())}}if(typeof u.d.intHTML!=="boolean"){u.d.intHTML.empty().remove()}else{u.d.input.on("datebox",function(e,t){if(t.method==="postrefresh"){u._fbox_pos()}})}u.d.headerText=u._grabLabel()!==false?u._grabLabel():a.mode==="flipbox"?u.__("titleDateDialogLabel"):u.__("titleTimeDialogLabel");u.d.intHTML=e("<span>");e(document).one("popupafteropen",function(){u._fbox_pos()});u.fldOrder=a.mode==="flipbox"?u.__("dateFieldOrder"):h?u.__("durationOrder"):u.__("timeFieldOrder");if(!h){u._check();u._minStepFix()}else{if(a.minDur!==false&&u.theDate.getEpoch()-u.initDate.getEpoch()<a.minDur){u.theDate=new Date(u.initDate.getTime()+a.minDur*1e3);u.lastDuration=a.minDur;g=u._dur(a.minDur*1e3)}if(a.maxDur!==false&&u.theDate.getEpoch()-u.initDate.getEpoch()>a.maxDur){u.theDate=new Date(u.initDate.getTime()+a.maxDur*1e3);u.lastDuration=a.maxDur;g=u._dur(a.maxDur*1e3)}}if(a.mode==="flipbox"){e("<div class='"+p+"header'><h4>"+u._formatter(u.__("headerFormat"),u.theDate)+"</h4></div>").appendTo(u.d.intHTML)}if(h){u._fbox_fixstep(u.fldOrder);i=e("<div class='"+p+"header ui-grid-"+u._gridblk.g[u.fldOrder.length]+"'></div>");for(n=0;n<u.fldOrder.length;n++){e("<div class='"+p+"fliplab ui-block-"+u._gridblk.b[n]+"'>"+u.__("durationLabel")[e.inArray(u.fldOrder[n],c)]+"</div>").appendTo(i)}i.appendTo(u.d.intHTML);u.dateOK=true;l.d=u._fbox_series(g[0],16,"d",false);l.h=u._fbox_series(g[1],16,"h",g[0]>0);l.i=u._fbox_series(g[2],20,"i",g[0]>0||g[1]>0);l.s=u._fbox_series(g[3],20,"s",g[0]>0||g[1]>0||g[2]>0);v.addClass(p+"flipcontentd");for(n=0;n<u.fldOrder.length;n++){o=u.fldOrder[n];y=g[e.inArray(o,c)];r=u._makeEl(d,{attr:{field:o,amount:a.durationSteppers[o]}});s=r.find("ul");for(t in l[o]){e("<li><span>"+l[o][t][0]+"</span></li>").addClass("ui-body-"+(l[o][t][1]!==y?a.themeDate:a.themeDatePick)).appendTo(s)}r.appendTo(v)}}for(n=0;n<u.fldOrder.length&&!h;n++){y=u.fldOrder[n];r=u._makeEl(d,{attr:{field:y,amount:y==="i"?a.minuteStep:1}});s=r.find("ul");if(typeof u._fbox_mktxt[y]==="function"){for(t=-1*a.flen[y];t<a.flen[y]+1;t++){e("<li class='ui-body-"+(t!==0?a.themeDate:a.themeDatePick)+"'><span>"+u._fbox_mktxt[y].apply(u,[y==="i"?t*a.minuteStep:t])+"</span></li>").appendTo(s)}r.appendTo(v)}if(y==="a"&&u.__("timeFormat")===12){b=e("<li class='ui-body-"+a.themeDate+"'><span></span></li>");i=u.theDate.get(3)>11?[a.themeDate,a.themeDatePick,2,5]:[a.themeDatePick,a.themeDate,2,3];for(t=-1*i[2];t<i[3];t++){if(t<0||t>1){b.clone().appendTo(s)}else{e("<li>",{"class":"ui-body-"+i[t]}).html("<span>"+u.__("meridiem")[t]+"</span>").appendTo(s)}}r.appendTo(v)}}u.d.intHTML.append(v);e("<div>",{"class":p+"flipcenter ui-overlay-shadow"}).css("pointerEvents","none").appendTo(u.d.intHTML);if(a.useSetButton||a.useClearButton){n=e("<div>",{"class":p+"controls"});if(a.useSetButton){n.append(u._stdBtn.close.apply(u,[a.mode==="flipbox"?u.__("setDateButtonLabel"):h?u.__("setDurationButtonLabel"):u.__("setTimeButtonLabel")]))}if(a.useClearButton){n.append(u._stdBtn.clear.apply(u))}if(a.useCollapsedBut){n.controlgroup({type:"horizontal"});n.addClass("ui-datebox-collapse")}else{n.controlgroup()}n.appendTo(u.d.intHTML)}if(u.wheelExists){u.d.intHTML.on("mousewheel",".ui-overlay-shadow",function(t,n){t.preventDefault();u._offset(e(this).data("field"),(n<0?-1:1)*e(this).data("amount"))})}u.d.intHTML.on(f.eStart,"ul",function(t,n){if(!f.move){if(typeof n!=="undefined"){t=n}f.move=true;f.target=e(this).find("li").first();f.pos=parseInt(f.target.css("marginTop").replace(/px/i,""),10);f.start=u.touch?t.originalEvent.changedTouches[0].pageY:t.pageY;f.end=false;f.direc=h?-1:1;t.stopPropagation();t.preventDefault()}})}});e.extend(e.mobile.datebox.prototype._drag,{timeflipbox:function(){this._drag.flipbox.apply(this)},durationflipbox:function(){this._drag.flipbox.apply(this)},flipbox:function(){var t=this,n=this.options,r=this.drag;e(document).on(r.eMove,function(e){if(r.move&&n.mode.slice(-7)==="flipbox"){r.end=t.touch?e.originalEvent.changedTouches[0].pageY:e.pageY;r.target.css("marginTop",r.pos+r.end-r.start+"px");e.preventDefault();e.stopPropagation();return false}});e(document).on(r.eEnd,function(e){if(r.move&&n.mode.slice(-7)==="flipbox"){r.move=false;if(r.end!==false){e.preventDefault();e.stopPropagation();r.tmp=r.target.parent().parent();t._offset(r.tmp.data("field"),parseInt((r.start-r.end)/(r.target.outerHeight()-2),10)*r.tmp.data("amount")*r.direc)}r.start=false;r.end=false}})}})})(jQuery)
